<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸©é¦¨å®¶åº­æ‰“å¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-blue: #4F46E5;
            --light-blue: #EEF2FF;
            --accent-purple: #7C3AED;
            --soft-gray: #F8FAFC;
            --pure-white: #FFFFFF;
            --text-dark: #1E293B;
            --text-gray: #64748B;
            --success-green: #10B981;
            --error-red: #EF4444;
            --gradient-primary: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #F1F5F9 0%, #FFFFFF 50%, #F8FAFC 100%);
            color: var(--text-dark);
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .app-container {
            min-height: 100vh;
            position: relative;
        }

        /* ç™»å½•é¡µé¢ */
        .login-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: var(--gradient-primary);
        }

        .login-card {
            background: var(--pure-white);
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 400px;
            text-align: center;
            animation: fadeInUp 0.8s ease-out;
        }

        .app-logo {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .app-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-dark);
            font-weight: 500;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--pure-white);
            box-sizing: border-box;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: var(--gradient-primary);
            color: var(--pure-white);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            width: 100%;
            padding: 16px;
            background: var(--pure-white);
            color: var(--primary-blue);
            border: 2px solid var(--primary-blue);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--light-blue);
        }

        .message {
            margin-top: 16px;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }

        .message.error {
            background: #FED7D7;
            color: #C53030;
            border: 1px solid #FEB2B2;
        }

        .message.success {
            background: #C6F6D5;
            color: #2F855A;
            border: 1px solid #9AE6B4;
        }

        .form-switch {
            text-align: center;
            margin-top: 20px;
            color: var(--text-gray);
            font-size: 14px;
        }

        .form-switch a {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 500;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="app-logo">ğŸ </div>
            <h1 class="app-title">æ¸©é¦¨å®¶åº­æ‰“å¡</h1>
            
            <!-- ç™»å½•è¡¨å• -->
            <div id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">é‚®ç®±åœ°å€</label>
                    <input type="email" id="loginEmail" class="form-input" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">å¯†ç </label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <button id="loginBtn" class="btn-primary">ç™»å½•</button>
                <button id="showRegisterBtn" class="btn-secondary">æ³¨å†Œæ–°è´¦æˆ·</button>
                <div id="loginMessage" class="message hidden"></div>
                <div class="form-switch">
                    <span>ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Ÿ</span>
                    <a href="#" onclick="showRegisterForm()">ç«‹å³æ³¨å†Œ</a>
                </div>
            </div>

            <!-- æ³¨å†Œè¡¨å• -->
            <div id="registerForm" class="hidden">
                <div class="form-group">
                    <label for="regName">å§“å</label>
                    <input type="text" id="regName" class="form-input" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
                </div>
                <div class="form-group">
                    <label for="regEmail">é‚®ç®±åœ°å€</label>
                    <input type="email" id="regEmail" class="form-input" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">å¯†ç </label>
                    <input type="password" id="regPassword" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required>
                </div>
                <button id="registerBtn" class="btn-primary">æ³¨å†Œ</button>
                <button id="backToLoginBtn" class="btn-secondary">è¿”å›ç™»å½•</button>
                <div id="regMessage" class="message hidden"></div>
                <div class="form-switch">
                    <span>å·²æœ‰è´¦æˆ·ï¼Ÿ</span>
                    <a href="#" onclick="showLoginForm()">ç«‹å³ç™»å½•</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨ -->
    <div id="mainApp" class="app-container hidden">
        <div style="padding: 20px; max-width: 600px; margin: 0 auto; text-align: center;">
            <h1 style="color: var(--primary-blue); margin-bottom: 20px;">ğŸ‰ ç™»å½•æˆåŠŸï¼</h1>
            <p style="color: var(--text-gray); margin-bottom: 30px;">æ¬¢è¿ä½¿ç”¨æ¸©é¦¨å®¶åº­æ‰“å¡ç³»ç»Ÿ</p>
            <div style="background: var(--pure-white); padding: 30px; border-radius: 20px; box-shadow: var(--shadow-lg);">
                <div style="font-size: 48px; margin-bottom: 20px;">ğŸ‘¤</div>
                <h2 id="userName" style="color: var(--text-dark); margin-bottom: 10px;">ç”¨æˆ·å§“å</h2>
                <p id="userEmail" style="color: var(--text-gray); margin-bottom: 30px;">user@example.com</p>
                <button onclick="handleLogout()" style="padding: 12px 24px; background: var(--error-red); color: white; border: none; border-radius: 8px; cursor: pointer;">é€€å‡ºç™»å½•</button>
            </div>
            <div style="margin-top: 30px; padding: 20px; background: var(--light-blue); border-radius: 16px;">
                <h3 style="color: var(--primary-blue); margin-bottom: 10px;">ğŸš€ åŠŸèƒ½å¼€å‘ä¸­</h3>
                <p style="color: var(--text-gray); font-size: 14px;">å®Œæ•´åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
            </div>
        </div>
    </div>

    <script>
        console.log('ğŸ  æ¸©é¦¨å®¶åº­æ‰“å¡ç³»ç»Ÿå¯åŠ¨');
        
        let currentUser = null;
        const STORAGE_KEY = 'family-checkin-shared-v4';
        
        let appData = {
            users: [],
            lastSync: 0
        };

        // åˆå§‹åŒ–æ•°æ®
        function initData() {
            try {
                const localData = localStorage.getItem('familyCheckin_allData');
                if (localData) {
                    const parsed = JSON.parse(localData);
                    appData.users = parsed.users || [];
                }
                
                // äº‘ç«¯åŒæ­¥
                const cloudData = localStorage.getItem(STORAGE_KEY);
                if (cloudData) {
                    const parsed = JSON.parse(cloudData);
                    if (parsed.users) {
                        appData.users = [...appData.users, ...parsed.users].filter((user, index, self) => 
                            index === self.findIndex(u => u.email === user.email)
                        );
                    }
                }
            } catch (e) {
                console.log('æ•°æ®åˆå§‹åŒ–å¤±è´¥:', e);
            }
        }

        // ä¿å­˜æ•°æ®
        function saveData() {
            try {
                localStorage.setItem('familyCheckin_allData', JSON.stringify(appData));
                localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
            } catch (e) {
                console.log('ä¿å­˜å¤±è´¥:', e);
            }
        }

        // åº”ç”¨åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initData();
            
            const savedUser = localStorage.getItem('familyCheckin_currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showMainApp();
                } catch (e) {
                    showLoginScreen();
                }
            } else {
                showLoginScreen();
            }

            bindEvents();
        });

        function bindEvents() {
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('showRegisterBtn').addEventListener('click', showRegisterForm);
            document.getElementById('registerBtn').addEventListener('click', handleRegister);
            document.getElementById('backToLoginBtn').addEventListener('click', showLoginForm);
        }

        function showLoginScreen() {
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('loginContainer').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
            }
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            clearMessages();
        }

        function showLoginForm() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            clearMessages();
        }

        function clearMessages() {
            document.getElementById('loginMessage').classList.add('hidden');
            document.getElementById('regMessage').classList.add('hidden');
        }

        function showMessage(elementId, message, type = 'error') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `message ${type}`;
            element.classList.remove('hidden');
        }

        function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showMessage('loginMessage', 'è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ');
                return;
            }

            const user = appData.users.find(u => u.email === email && u.password === password);
            if (!user) {
                showMessage('loginMessage', 'é‚®ç®±æˆ–å¯†ç é”™è¯¯');
                return;
            }

            currentUser = user;
            localStorage.setItem('familyCheckin_currentUser', JSON.stringify(user));
            showMessage('loginMessage', 'ç™»å½•æˆåŠŸï¼', 'success');
            
            setTimeout(() => showMainApp(), 1000);
        }

        function handleRegister() {
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value;

            if (!name || !email || !password) {
                showMessage('regMessage', 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            if (password.length < 6) {
                showMessage('regMessage', 'å¯†ç è‡³å°‘éœ€è¦6ä½');
                return;
            }

            if (appData.users.find(u => u.email === email)) {
                showMessage('regMessage', 'é‚®ç®±å·²è¢«ä½¿ç”¨');
                return;
            }

            const newUser = {
                id: Date.now().toString(),
                name: name,
                email: email,
                password: password,
                createdAt: Date.now()
            };

            appData.users.push(newUser);
            saveData();

            showMessage('regMessage', 'æ³¨å†ŒæˆåŠŸï¼æ­£åœ¨ç™»å½•...', 'success');
            
            setTimeout(() => {
                currentUser = newUser;
                localStorage.setItem('familyCheckin_currentUser', JSON.stringify(newUser));
                showMainApp();
            }, 1000);
        }

        function handleLogout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                currentUser = null;
                localStorage.removeItem('familyCheckin_currentUser');
                showLoginScreen();
            }
        }

        console.log('ğŸ‰ ç³»ç»ŸåŠ è½½å®Œæˆ');
    </script>
</body>
</html>